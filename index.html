<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
		<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script> 
		<script type="text/javascript">
			function posicion(){
          var inicio = new Date().getTime();
			    var geoOptions = { enableHighAccuracy: true, timeout: 10000 };
			    navigator.geolocation.getCurrentPosition(function(posicion){ // geoSuccess
			        // ya tenemos la posicion
              var actual = posicion.timestamp;
              var retraso = actual - inicio;
              $("#posicion").html("Latitud: "+posicion.coords.latitude+"</br>Longitud: "+posicion.coords.longitude+"</br>Retraso: "+retraso/1000);
              ciudad(posicion.coords.latitude,posicion.coords.longitude);
			    }, function(error){ // geoError
			        $("#error").html('Error: ' + error.message + '\n' + 'code: ' + error.code);
			    }, geoOptions);
			}
			function ciudad(lat, lng) {
				var geocoder = new google.maps.Geocoder();
				var latlng = new google.maps.LatLng(lat, lng);
				geocoder.geocode({'latLng': latlng}, function(results, status) {
					if (status == google.maps.GeocoderStatus.OK) {
						if (results[1]) {
							//formatted address
							 $("#direccion").html("Direccion completa: "+results[0].formatted_address)
							//find country name
							for (var i=0; i<results[0].address_components.length; i++) {
								for (var b=0;b<results[0].address_components[i].types.length;b++) {
									//there are different types that might hold a city admin_area_lvl_1 usually does in come cases looking for sublocality type will be more appropriate
									if (results[0].address_components[i].types[b] == "administrative_area_level_1") {
										//this is the object you are looking for
										city= results[0].address_components[i];
										break;
									}
								}
							}
							//city data
							var aux = $("#direccion").html()
							$("#direccion").html(aux + "</br>Ciudad: " + city.short_name + " " + city.long_name)
						} else {
							$("#error").html("No se encontraron resultados");
						}
					} else {
						$("#error").html("Geocoder fallo debido a: " + status);
					}
			});
		}
		</script>
		<style type="text/css">
			#content{float: left;width:300px;height:200px;border-radius:25px;background-color:#D8D8D8;}
			#decime{position: relative;margin-left:25%;margin-top:5%;border-radius:25px;}
			p{font-family: sans-serif;font-size:12px;margin-left: 10px;}
			#address{color:green;}
			#position{color:green;}
			#error{color:red;}
		</style>
	</head>
	<body>
		<div id="content">
			<button id="decime" onclick="posicion()">Decime mi posicion</button>
			<p id="posicion"></p>
			<p id="direccion"></p>
			<p id="error"></p>
		</div>
	</body>
</html>